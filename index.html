<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>çµ‚æ¥µå¯©åˆ¤ï¼šé›»è»Šé›£é¡Œ â€” åˆ†å‰è»Œé“ Demoï¼ˆæ‹–æ‹½å‡ºç‰Œ / è½é»é è¦½ï¼‰</title>
  <style>
    :root{ --bg:#0b1020; --panel:#0f1630; --line:#1f2a55; --fg:#e6edf3; --muted:#9aa7bd; --card:#17213f; --accent:#5bd1ff; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
    header,footer{padding:12px 16px}
    header{display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--line)}
    h1{font-size:18px;margin:0}
    .btn{cursor:pointer;border:1px solid #2a355f;background:#121a36;color:var(--fg);padding:8px 12px;border-radius:10px}
    .pill{font-size:12px;border:1px solid #2a355f;border-radius:999px;padding:4px 8px;display:inline-block;color:var(--muted)}

    .board{display:grid;grid-template-columns:1fr 420px;gap:16px;padding:16px}

    /* èˆå°èˆ‡èƒŒæ™¯ */
    .stage{position:relative;background:var(--panel) center/cover no-repeat;border:1px solid var(--line);border-radius:16px;overflow:hidden;min-height:560px}
    .stage.has-bg{background-image:url('assets/track.png');}
    .legend{position:absolute;inset:auto 12px 12px 12px;color:var(--muted);font-size:13px}

    /* è»Šé“ï¼šæœå³å»¶å±•ã€æ²¿è»Œé“æ—‹è½‰ */
    .lane{position:absolute;display:flex;gap:12px;align-items:flex-end;transform-origin:left center}
    .lane.A{top:120px;left:285px;transform:rotate(-8deg)}  /* ä¸Šå‰è·¯ */
    .lane.B{bottom:118px;left:285px;transform:rotate(8deg)} /* ä¸‹å‰è·¯ */

    /* å¡ç‰‡èˆ‡ä¿®é£¾ */
    .card{background:var(--card);border:1px solid #2b3a6b;border-radius:10px;padding:6px 8px;min-width:150px;max-width:220px;position:relative}
    .card .type{font-size:12px;color:var(--muted)}
    .card .title{font-weight:700}
    .mods{position:absolute;left:50%;transform:translateX(-50%);top:-6px;display:flex;flex-direction:column;gap:4px}
    .mod{font-size:11px;background:#1a2548;border:1px solid #33437a;border-radius:8px;padding:2px 6px;color:#cfe4ff;align-self:center}

    /* æ‰‹ç‰Œå´æ¬„ */
    .side{display:grid;grid-template-rows:auto 1fr}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:12px}
    .tabbar{display:flex;gap:8px;margin-top:6px}
    .tab{padding:6px 10px;border-radius:10px;border:1px solid #2a355f;background:#111834;cursor:pointer}
    .tab.active{background:#1a2346;color:#cfe4ff}
    .hand{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px}
    .cardBtn{background:#161f3e;border:1px solid #2a355f;border-radius:10px;padding:6px 8px;text-align:left}

    /* æ‹–æ‹½æ…‹èˆ‡è½é»é è¦½ */
    .draggable{cursor:grab}
    .droppable{outline:2px dashed rgba(91,209,255,.35)}
    .drop-ok{outline:3px solid rgba(91,209,255,.85)}
    .drop-no{outline:3px solid rgba(255,120,120,.85)}
    .ghost-card{opacity:.45;filter:saturate(.7);border-style:dashed}

    .log{background:#0e152f;border:1px solid var(--line);border-radius:12px;padding:8px;height:160px;overflow:auto;white-space:pre-wrap;color:#cdd9e5}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸšï¸ çµ‚æ¥µå¯©åˆ¤ï¼šé›»è»Šé›£é¡Œ â€” åˆ†å‰è»Œé“ï¼ˆæ‹–æ‹½ + è½é»é è¦½ï¼‰</h1>
      <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
        <span class="pill">ç•¶å‰ç©å®¶ï¼š<b id="turnPlayer">A</b></span>
        <button class="btn" id="btnSwitch">åˆ‡æ›ç©å®¶</button>
        <button class="btn" id="btnReset">é‡ç½®å›åˆ</button>
      </div>
    </header>

    <main class="board">
      <section class="stage has-bg" id="stage">
        <div class="lane A" id="laneA" data-side="A"></div>
        <div class="lane B" id="laneB" data-side="B"></div>
        <div class="legend">å¾æ‰‹ç‰Œæ‹–åˆ°èˆå°ï¼šå–„â†’è‡ªå·±è»Œï¼›æƒ¡â†’å°æ–¹è»Œï¼›ç‰¹æ€§â†’æ‹–åˆ°ä»»ä¸€å·²æ”¾ç½®å¡ç–ŠåŠ ã€‚æ”¯æŒè½é»â€œåŠé€æ˜é è¦½â€ã€‚</div>
      </section>

      <aside class="side">
        <div class="panel">
          <div style="display:flex;justify-content:space-between"><span class="pill">ç©å®¶ Aï¼šå–„/æƒ¡/ç‰¹</span><span class="pill">ç©å®¶ Bï¼šå–„/æƒ¡/ç‰¹</span></div>
          <div class="tabbar">
            <div class="tab active" data-tab="innocent">å–„è‰¯å¡</div>
            <div class="tab" data-tab="guilty">é‚ªæƒ¡å¡</div>
            <div class="tab" data-tab="modifier">ç‰¹æ€§å¡</div>
          </div>
          <div id="hand" class="hand"></div>
        </div>
        <div class="panel">
          <strong>æ“ä½œè¨˜éŒ„</strong>
          <div id="log" class="log"></div>
        </div>
      </aside>
    </main>

    <footer>
      <span class="pill">è‹¥éœ€è¦æ›´è²¼è»Œï¼Œå¾®èª¿ <code>.lane.A/.lane.B</code> çš„ <code>top/left/bottom/rotate()</code>ã€‚</span>
    </footer>
  </div>

  <script>
  // ------- ç‹€æ…‹ -------
  const state = {
    turn:'A',
    hands:{
      A:{innocent:['å¤©æ‰é†«ç”Ÿ','å¹¼å…’åœ’è€å¸«','æ°£å€™ç§‘å­¸å®¶'],guilty:['é€ƒçŠ¯','é‚ªæ•™é ­ç›®','ç¶²è·¯è©é¨™çŠ¯'],modifier:['å…¶å¯¦æ˜¯ä½ è¡¨è¦ª','åªæœ‰ä¸€é€±å£½å‘½','å…¶ç ”ç©¶å°‡æ‹¯æ•‘ç™¾è¬äºº']},
      B:{innocent:['æ¶ˆé˜²å“¡','æµæµªè²“æ•‘åŠ©è€…','å¿—é¡˜è€…'],guilty:['çµäººå·çµè€…','æˆ°çŠ¯','æƒ¡éœ¸æˆ¿æ±'],modifier:['æš—åœ°è£¡è³‡åŠ©æ…ˆå–„','å…¶å¯¦æ˜¯AIè¤‡è£½é«”','æœƒç™¼æ˜æ¸…æ½”èƒ½æº']},
    },
    lanes:{A:[],B:[]}, // å¡ï¼š{title,type,owner,mods:[]}
    activeTab:'innocent',
    dragging:null // {type,title,from,index}
  };
  const initialHands = JSON.parse(JSON.stringify(state.hands));

  const handEl = document.getElementById('hand');
  const laneA = document.getElementById('laneA');
  const laneB = document.getElementById('laneB');
  const logEl = document.getElementById('log');

  function log(m){ logEl.textContent += `${new Date().toLocaleTimeString()} ${m}\n`; logEl.scrollTop = logEl.scrollHeight; }

  // ------- æ‰‹ç‰Œï¼ˆå¯æ‹–æ‹½ï¼‰ -------
  function tabLabel(t){return t==='innocent'?'å–„':t==='guilty'?'æƒ¡':'ç‰¹';}

  function renderHand(){
    handEl.innerHTML='';
    const me = state.turn; const list = state.hands[me][state.activeTab];
    if (!list.length){ const d=document.createElement('div'); d.style.color='var(--muted)'; d.textContent='ï¼ˆè©²é¡å¡å·²ç”¨ç›¡ï¼‰'; handEl.appendChild(d); return; }
    list.forEach((title,i)=>{
      const btn = document.createElement('div');
      btn.className='cardBtn draggable'; btn.draggable = true;
      btn.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong>${title}</strong><span class="pill">${tabLabel(state.activeTab)}</span></div>`;
      btn.addEventListener('dragstart', ev=>{
        state.dragging = {type:state.activeTab,title,from:me,index:i};
        ev.dataTransfer.setData('text/plain', JSON.stringify(state.dragging));
        ev.dataTransfer.dropEffect = 'copy';
        setDropHints(true);
      });
      btn.addEventListener('dragend', ()=>{ state.dragging=null; setDropHints(false); clearGhosts(); });
      handEl.appendChild(btn);
    });
  }

  // ------- å ´ä¸Šå¡ç‰Œ -------
  function renderLanes(){
    laneA.innerHTML=''; laneB.innerHTML='';
    state.lanes.A.forEach((c,i)=> laneA.appendChild(renderCardEl('A',i,c)));
    state.lanes.B.forEach((c,i)=> laneB.appendChild(renderCardEl('B',i,c)));
  }

  function renderCardEl(side, idx, card){
    const wrap = document.createElement('div');
    wrap.className='card';
    wrap.innerHTML = `<div class="type">${card.type==='innocent'?'å–„è‰¯':'é‚ªæƒ¡'}ãƒ»${card.owner}</div><div class="title">${card.title}</div>`;
    const mods = document.createElement('div'); mods.className='mods';
    card.mods.forEach(m=>{ const d=document.createElement('div'); d.className='mod'; d.textContent=m; mods.appendChild(d); });
    wrap.appendChild(mods);

    // ä½œç‚ºã€Œç‰¹æ€§å¡ã€æŠ•æ”¾ç›®æ¨™ï¼šæä¾›é«˜äº®èˆ‡æ”¾ç½®
    wrap.addEventListener('dragover', ev=>{
      const d = state.dragging; if (!d || d.type!=='modifier') return; ev.preventDefault(); wrap.classList.add('drop-ok');
    });
    wrap.addEventListener('dragleave', ()=> wrap.classList.remove('drop-ok'));
    wrap.addEventListener('drop', ev=>{
      ev.preventDefault();
      const d = state.dragging; wrap.classList.remove('drop-ok'); if (!d || d.type!=='modifier') return;
      card.mods.push(d.title);
      state.hands[d.from].modifier.splice(d.index,1);
      state.dragging=null; setDropHints(false); clearGhosts();
      log(`ç©å®¶ ${state.turn} å°ã€Œ${card.title}ã€ç–ŠåŠ ç‰¹æ€§ï¼š${card.mods.slice(-1)[0]}`);
      renderAll();
    });
    return wrap;
  }

  // ------- å…è¨±æ‹–åˆ°å“ªæ¢è»Œ & è½é»é è¦½ -------
  function canDropToLane(side){
    const d = state.dragging; if (!d) return false;
    const me = state.turn; if (d.type==='innocent') return side===me; if (d.type==='guilty') return side!==me; return false;
  }

  function makeGhost(){
    const g = document.createElement('div');
    g.className = 'card ghost-card';
    g.innerHTML = `<div class="type">è½é»é è¦½</div><div class="title">${state.dragging?state.dragging.title:''}</div>`;
    return g;
  }
  let ghostA=null, ghostB=null;
  function clearGhosts(){ if (ghostA){ghostA.remove(); ghostA=null;} if (ghostB){ghostB.remove(); ghostB=null;} }

  function setDropHints(on){
    [laneA,laneB].forEach(l=>{
      l.classList.toggle('droppable', on);
      if (on && canDropToLane(l.dataset.side)){
        l.classList.add('drop-ok'); l.classList.remove('drop-no');
      } else if (on){
        l.classList.add('drop-no'); l.classList.remove('drop-ok');
      } else {
        l.classList.remove('drop-ok','drop-no');
      }
    });
  }

  [laneA,laneB].forEach(lane=>{
    lane.addEventListener('dragover', ev=>{
      if (!canDropToLane(lane.dataset.side)) return; ev.preventDefault(); ev.dataTransfer.dropEffect='copy';
      // é¡¯ç¤º/æ›´æ–°è©² lane çš„ ghost
      if (lane===laneA){ if (!ghostA){ ghostA = makeGhost(); lane.appendChild(ghostA); } }
      else { if (!ghostB){ ghostB = makeGhost(); lane.appendChild(ghostB); } }
    });
    lane.addEventListener('dragleave', ()=>{
      // ç§»é™¤è©² lane çš„ ghost
      if (lane===laneA && ghostA){ ghostA.remove(); ghostA=null; }
      if (lane===laneB && ghostB){ ghostB.remove(); ghostB=null; }
    });
    lane.addEventListener('drop', ev=>{
      ev.preventDefault();
      const d = state.dragging; if (!d) return; if (!canDropToLane(lane.dataset.side)) return;
      const card = {title:d.title,type:d.type,owner:state.turn,mods:[]};
      state.lanes[lane.dataset.side].push(card);
      state.hands[d.from][d.type].splice(d.index,1);
      state.dragging=null; setDropHints(false); clearGhosts();
      log(`ç©å®¶ ${state.turn} åœ¨è»Œé“ ${lane.dataset.side} å³å´æ¥å…¥ã€${tabLabel(d.type)}ã€‘ã€Œ${d.title}ã€`);
      renderAll();
    });
  });

  // ------- æ§åˆ¶ -------
  document.getElementById('btnSwitch').onclick = ()=>{
    state.turn = state.turn==='A'?'B':'A';
    document.getElementById('turnPlayer').textContent = state.turn;
    log(`åˆ‡æ›åˆ°ç©å®¶ ${state.turn}`); renderAll();
  };
  document.getElementById('btnReset').onclick = ()=>{
    state.lanes={A:[],B:[]}; state.hands=JSON.parse(JSON.stringify(initialHands)); state.turn='A';
    document.getElementById('turnPlayer').textContent='A'; log('å›åˆå·²é‡ç½®'); renderAll();
  };

  // Tabs
  document.querySelectorAll('.tab').forEach(t=>{
    t.addEventListener('click', ()=>{
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active'); state.activeTab = t.dataset.tab; renderHand();
    });
  });

  function renderAll(){ renderLanes(); renderHand(); }
  renderAll();
  log('æç¤ºï¼šæ‹–æ‹½å‡ºç‰Œå·²ä¿®å¾©ï¼›æ”¯æŒåŠé€æ˜â€œè½é»é è¦½â€ã€‚ä¸‹ä¸€æ­¥å¯åŠ ï¼šå›åˆé †åºã€è£æ±ºèˆ‡è¨ˆåˆ†ã€‚');
  </script>
</body>
</html>