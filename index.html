<!doctype html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8">
  <title>终极审判：电车难题 — Demo</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
    .board { display: flex; gap: 20px; margin-bottom: 20px; }
    .track { background: #fff; padding: 10px; flex: 1; }
    .track h3 { margin-top: 0; }
    button { padding: 8px 12px; margin-right: 10px; }
    .hand { margin: 10px 0; }
    .log { background: #eee; padding: 10px; margin-top: 20px; height: 150px; overflow: auto; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>终极审判：电车难题 桌游 Demo</h1>
  <div>
    <button id="startRound">开始新回合</button>
    <span>列车长：<span id="conductor">—</span></span>
  </div>
  <div class="board">
    <div class="track" id="trackA">
      <h3>轨道 A</h3>
      <ul></ul>
    </div>
    <div class="track" id="trackB">
      <h3>轨道 B</h3>
      <ul></ul>
    </div>
  </div>
  <div>
    <h4>当前回合操作</h4>
    <button id="playInnocent">出“好人”到自己轨道</button>
    <button id="playGuilty">出“坏人”到对方轨道</button>
    <button id="playModifier">出“特性卡”到任意目标</button>
    <button id="decide">列车长决定撞 A 或 B</button>
  </div>
  <div class="log" id="log">游戏日志...</div>

  <script>
    const logEl = document.getElementById('log');
    function log(msg) {
      logEl.textContent += msg + '\\n';
      logEl.scrollTop = logEl.scrollHeight;
    }

    const deck = {
      innocent: ['Baby', 'Hero', 'Puppy', 'Your Mom'],
      guilty: ['Hitler', 'Robber', 'Mosquito', 'Taxman'],
      modifier: ['Immortal', 'Deserves It', 'One Month Left']
    };

    const state = {
      players: ['Alice','Bob','Carol','Dave'],
      conductor: null,
      trackA: [],
      trackB: [],
      hands: {}
    };

    function startRound() {
      state.trackA = [];
      state.trackB = [];
      const idx = Math.floor(Math.random() * state.players.length);
      state.conductor = state.players[idx];
      document.getElementById('conductor').textContent = state.conductor;
      log('新回合开始，列车长是 ' + state.conductor);

      state.players.forEach(p => {
        state.hands[p] = {
          innocent: shuffle([...deck.innocent]).slice(0,3),
          guilty: shuffle([...deck.guilty]).slice(0,3),
          modifier: shuffle([...deck.modifier]).slice(0,3),
        };
        log(p + ' 抽到卡片：' + JSON.stringify(state.hands[p]));
      });

      renderTracks();
    }

    function shuffle(arr) {
      for (let i = arr.length-1; i>0; i--) {
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function renderTracks() {
      ['A','B'].forEach(side => {
        const ul = document.querySelector('#track' + side + ' ul');
        ul.innerHTML = '';
        state['track'+side].forEach(c => {
          const li = document.createElement('li');
          li.textContent = c;
          ul.appendChild(li);
        });
      });
    }

    document.getElementById('startRound').onclick = startRound;

    document.getElementById('playInnocent').onclick = () => {
      const p = state.players.find(x => x !== state.conductor);
      if (!p) return;
      const card = state.hands[p].innocent.pop();
      state.trackA.push(card);
      log(p + ' 出“好人”卡到轨道 A：' + card);
      renderTracks();
    };

    document.getElementById('playGuilty').onclick = () => {
      const p = state.players.find(x => x !== state.conductor);
      if (!p) return;
      const card = state.hands[p].guilty.pop();
      state.trackB.push(card);
      log(p + ' 出“坏人”卡到轨道 B：' + card);
      renderTracks();
    };

    document.getElementById('playModifier').onclick = () => {
      const p = state.players.find(x => x !== state.conductor);
      if (!p) return;
      const card = state.hands[p].modifier.pop();
      state.trackA.push('('+card+')');
      log(p + ' 出“特性卡”附加到轨道 A：' + card);
      renderTracks();
    };

    document.getElementById('decide').onclick = () => {
      const choice = Math.random() < 0.5 ? 'A' : 'B';
      log(state.conductor + ' 决定撞轨道 ' + choice);
    };
  </script>
</body>
</html>
